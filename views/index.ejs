<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Shopify Automator v2.5</title>
    <style>
        :root { --p: #008060; }
        body { font-family: system-ui; background: #f6f6f7; padding: 20px; }
        .card { background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
        textarea { width: 100%; height: 100px; border: 1px solid #ccc; border-radius: 5px; margin-top: 5px; }
        .btn { background: var(--p); color: #fff; border: none; padding: 12px; border-radius: 5px; cursor: pointer; font-weight: bold; width: 100%; }
        .status-box { background: #1e1e1e; color: #00ff41; padding: 15px; border-radius: 5px; height: 200px; overflow-y: auto; font-family: monospace; font-size: 13px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .row { display: flex; gap: 15px; align-items: flex-end; margin-bottom: 10px; }
        input { padding: 8px; border: 1px solid #ccc; border-radius: 4px; }
    </style>
</head>
<body>
    <div style="max-width: 800px; margin: auto;">
        <h3>üöÄ Shopify Multi-Account Creator</h3>
        
        <div class="grid">
            <div class="card"><label>H·ªç:</label><textarea id="hoInput">Nguyen&#10;Tran</textarea></div>
            <div class="card"><label>T√™n:</label><textarea id="tenInput">An&#10;Binh</textarea></div>
        </div>

        <div class="card">
            <div class="row">
                <div style="flex:1"><label>2Captcha API Key:</label><br><input type="text" id="captchaKey" style="width:100%" placeholder="ƒê·ªÉ tr·ªëng n·∫øu t·ª± gi·∫£i"></div>
                <div><label>S·ªë l∆∞·ª£ng:</label><br><input type="number" id="qty" value="5" style="width:60px"></div>
                <div><label>Lu·ªìng:</label><br><input type="number" id="con" value="2" style="width:50px"></div>
                <div style="flex:1"><button class="btn" id="startBtn" onclick="start()">B·∫ÆT ƒê·∫¶U CH·∫†Y</button></div>
            </div>
        </div>

        <div class="card status-box" id="logArea">>> S·∫µn s√†ng.</div>
        <div style="text-align: right;"><a href="/download" id="dl" style="display:none; color: blue;">‚¨á T·∫£i file k·∫øt qu·∫£ (.xlsx)</a></div>
    </div>

    <script>
        let lastMsg = "";
        function addLog(m) {
            if (!m || m === lastMsg) return;
            lastMsg = m;
            const logArea = document.getElementById("logArea");
            logArea.innerHTML += `<div>[${new Date().toLocaleTimeString()}] ${m}</div>`;
            logArea.scrollTop = logArea.scrollHeight;
        }

        async function start() {
            const body = {
                hoList: document.getElementById("hoInput").value.split("\n").filter(x => x.trim()),
                tenList: document.getElementById("tenInput").value.split("\n").filter(x => x.trim()),
                quantity: parseInt(document.getElementById("qty").value),
                concurrency: parseInt(document.getElementById("con").value),
                captchaKey: document.getElementById("captchaKey").value.trim()
            };

            document.getElementById("startBtn").disabled = true;
            addLog("ƒêang k·∫øt n·ªëi server...");

            await fetch("/start", { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(body) });

            const timer = setInterval(async () => {
                const res = await fetch("/status");
                const s = await res.json();
                if (s.log) addLog(s.log);
                if (!s.isRunning && s.current >= s.total) {
                    clearInterval(timer);
                    document.getElementById("startBtn").disabled = false;
                    document.getElementById("dl").style.display = "block";
                    addLog("--- HO√ÄN TH√ÄNH ---");
                }
            }, 2000);
        }
    </script>
</body>
</html>
